<Window x:Class="QuickMusic3.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:QuickMusic3"
        xmlns:converters="clr-namespace:QuickMusic3.Converters"
        xmlns:viewmodel="clr-namespace:QuickMusic3.MVVM.ViewModel"
        mc:Ignorable="d"
        Height="340"
        Width="1200"
        Closed="Window_Closed">
    <Window.DataContext>
        <viewmodel:MainViewModel />
    </Window.DataContext>
    <Window.Resources>
        <converters:TimeConverter x:Key="TimeConverter" />
        <converters:TimeStringConverter x:Key="TimeStringConverter" />
        <converters:AlbumArtFitter x:Key="AlbumArtFitter" />
        <Style x:Key="SliderButtonStyle"
               TargetType="{x:Type RepeatButton}">
            <Setter Property="SnapsToDevicePixels"
                    Value="true" />
            <Setter Property="OverridesDefaultStyle"
                    Value="true" />
            <Setter Property="IsTabStop"
                    Value="false" />
            <Setter Property="Focusable"
                    Value="false" />
        </Style>
        <Style x:Key="IncreaseSliderButtonStyle"
               TargetType="{x:Type RepeatButton}"
               BasedOn="{StaticResource SliderButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type RepeatButton}">
                        <Border Background="Transparent" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="DecreaseSliderButtonStyle"
               TargetType="{x:Type RepeatButton}"
               BasedOn="{StaticResource SliderButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type RepeatButton}">
                        <Border Background="#7fb2f0" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="SliderThumbStyle"
               TargetType="{x:Type Thumb}">
            <Setter Property="SnapsToDevicePixels"
                    Value="true" />
            <Setter Property="OverridesDefaultStyle"
                    Value="true" />
        </Style>
        <Style x:Key="RectangleSliderThumbStyle"
               TargetType="{x:Type Thumb}"
               BasedOn="{StaticResource SliderThumbStyle}">
            <Setter Property="Height"
                    Value="14" />
            <Setter Property="Width"
                    Value="8" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Thumb}">
                        <Rectangle Fill="#0078d7"
                                   Margin="0,-4,0,-4" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="CircleSliderThumbStyle"
               TargetType="{x:Type Thumb}"
               BasedOn="{StaticResource SliderThumbStyle}">
            <Setter Property="Height"
                    Value="4" />
            <Setter Property="Width"
                    Value="4" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Thumb}">
                        <Ellipse Fill="#0078d7"
                                 Margin="-5" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <ControlTemplate x:Key="CircleSlider"
                         TargetType="{x:Type Slider}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Border Name="TrackBackground"
                        Grid.Row="1"
                        Background="#c8c8c8" />
                <Track Grid.Row="1"
                       Name="PART_Track">
                    <Track.DecreaseRepeatButton>
                        <RepeatButton Style="{StaticResource DecreaseSliderButtonStyle}"
                                      Command="Slider.DecreaseLarge" />
                    </Track.DecreaseRepeatButton>
                    <Track.Thumb>
                        <Thumb Style="{StaticResource CircleSliderThumbStyle}" />
                    </Track.Thumb>
                    <Track.IncreaseRepeatButton>
                        <RepeatButton Style="{StaticResource IncreaseSliderButtonStyle}"
                                      Command="Slider.IncreaseLarge" />
                    </Track.IncreaseRepeatButton>
                </Track>
                <Rectangle Fill="Transparent"
                           Grid.Row="0"
                           Height="20" />
                <Rectangle Fill="Transparent"
                           Grid.Row="2"
                           Height="20" />
            </Grid>
        </ControlTemplate>
        <ControlTemplate x:Key="RectangleSlider"
                         TargetType="{x:Type Slider}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Border Name="TrackBackground"
                        Grid.Row="1"
                        Background="#c8c8c8" />
                <Track Grid.Row="1"
                       Name="PART_Track">
                    <Track.DecreaseRepeatButton>
                        <RepeatButton Style="{StaticResource DecreaseSliderButtonStyle}"
                                      Command="Slider.DecreaseLarge" />
                    </Track.DecreaseRepeatButton>
                    <Track.Thumb>
                        <Thumb Style="{StaticResource RectangleSliderThumbStyle}" />
                    </Track.Thumb>
                    <Track.IncreaseRepeatButton>
                        <RepeatButton Style="{StaticResource IncreaseSliderButtonStyle}"
                                      Command="Slider.IncreaseLarge" />
                    </Track.IncreaseRepeatButton>
                </Track>
                <Rectangle Fill="Transparent"
                           Grid.Row="0"
                           Height="10" />
                <Rectangle Fill="Transparent"
                           Grid.Row="2"
                           Height="10" />
            </Grid>
        </ControlTemplate>
        <Style x:Key="SliderStyle"
               TargetType="{x:Type Slider}">
            <Setter Property="SnapsToDevicePixels"
                    Value="true" />
            <Setter Property="OverridesDefaultStyle"
                    Value="true" />
            <Setter Property="IsMoveToPointEnabled"
                    Value="true" />
            <Setter Property="Focusable"
                    Value="false" />
        </Style>
        <Style x:Key="CircleSliderStyle"
               TargetType="{x:Type Slider}"
               BasedOn="{StaticResource SliderStyle}">
            <Setter Property="Template"
                    Value="{StaticResource CircleSlider}" />
        </Style>
        <Style x:Key="RectangleSliderStyle"
               TargetType="{x:Type Slider}"
               BasedOn="{StaticResource SliderStyle}">
            <Setter Property="Template"
                    Value="{StaticResource RectangleSlider}" />
        </Style>
    </Window.Resources>
    <Grid x:Name="MainGrid">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*">
                <ColumnDefinition.MaxWidth>
                    <MultiBinding Converter="{StaticResource AlbumArtFitter}">
                        <Binding Path="Player.CurrentTrack.Metadata.HighResImage" />
                        <Binding Path="ActualHeight"
                                 ElementName="MainGrid" />
                    </MultiBinding>
                </ColumnDefinition.MaxWidth>
            </ColumnDefinition>
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>
        <Grid Grid.Column="0">
            <Image x:Name="AlbumArt"
                   Source="{Binding Player.CurrentTrack.Metadata.HighResImage}"
                   RenderOptions.BitmapScalingMode="HighQuality"
                   VerticalAlignment="Center">
            </Image>
        </Grid>
        <Grid Grid.Column="1"
              Background="#f0f0f0">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="0"
                        Margin="20,5,10,5"
                        Orientation="Vertical">
                <TextBlock Text="{Binding Path=Player.CurrentTrack.Metadata.Title, FallbackValue=Title}"
                           FontSize="36"
                           FontFamily="Arial"
                           TextWrapping="WrapWithOverflow" />
                <TextBlock Text="{Binding Path=Player.CurrentTrack.Metadata.Artist, FallbackValue=Artist}"
                           FontSize="36"
                           FontFamily="Arial"
                           Foreground="#a0a0a0"
                           TextWrapping="WrapWithOverflow" />
                <TextBlock Text="{Binding Path=Player.CurrentTrack.Metadata.Album, FallbackValue=Album}"
                           FontSize="36"
                           FontFamily="Arial"
                           Foreground="#a0a0a0"
                           TextWrapping="WrapWithOverflow" />
            </StackPanel>
            <StackPanel Grid.Row="1"
                        Orientation="Vertical"
                        Margin="20,5,10,5">
                <Grid>
                    <TextBlock Text="{Binding Path=Player.CurrentTime, Converter={StaticResource TimeStringConverter}}"
                               FontSize="18"
                               HorizontalAlignment="Left" />
                    <TextBlock Text="{Binding Path=Player.TotalTime, Converter={StaticResource TimeStringConverter}}"
                               FontSize="18"
                               HorizontalAlignment="Right" />
                </Grid>
                <local:CustomSlider Style="{StaticResource RectangleSliderStyle}"
                                    Maximum="{Binding Path=Player.TotalTime, Converter={StaticResource TimeConverter}}"
                                    Value="{Binding Path=Player.CurrentTime, Converter={StaticResource TimeConverter}}"
                                    GotMouseCapture="TimeBar_MouseDown"
                                    LostMouseCapture="TimeBar_MouseUp" />
                <Grid>
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Left">
                        <Button Width="42"
                                Height="42"
                                Focusable="False"
                                Margin="0,0,6,0"
                                Command="{Binding PlayPauseCommand}">
                            <Image Margin="1"
                                   SnapsToDevicePixels="True">
                                <Image.Style>
                                    <Style>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Player.PlayState}"
                                                         Value="Playing">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/pause.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Player.PlayState}"
                                                         Value="Paused">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/play.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding PlayDragging, RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}"
                                                         Value="true">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/pause.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                        </Button>
                        <Button Width="42"
                                Height="42"
                                Focusable="False"
                                Margin="0,0,6,0"
                                Command="{Binding ChangeRepeatCommand}">
                            <Image Margin="2"
                                   SnapsToDevicePixels="True">
                                <Image.Style>
                                    <Style>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Player.RepeatMode}"
                                                         Value="RepeatAll">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/repeat_all.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Player.RepeatMode}"
                                                         Value="RepeatOne">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/repeat_one.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Player.RepeatMode}"
                                                         Value="PlayAll">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/once.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                        </Button>
                        <Button Width="42"
                                Height="42"
                                Focusable="False"
                                Margin="0,0,6,0"
                                Command="{Binding ChangeShuffleCommand}">
                            <Image Source="/Resources/shuffle.png"
                                   Margin="1"
                                   SnapsToDevicePixels="True">
                                <Image.Style>
                                    <Style>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Player.Shuffle}"
                                                         Value="false">
                                                <Setter Property="Image.Opacity"
                                                        Value="0.2" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                        </Button>
                        <Button Width="32"
                                Height="42"
                                Focusable="False"
                                Margin="0,0,6,0"
                                Command="{Binding ChangeMuteCommand}"
                                Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                            <Image Margin="-4"
                                   SnapsToDevicePixels="True">
                                <Image.Style>
                                    <Style>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Player.Muted}"
                                                         Value="true">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/mute.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Player.Muted}"
                                                         Value="false">
                                                <Setter Property="Image.Source"
                                                        Value="/Resources/volume.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                        </Button>
                        <local:CustomSlider Style="{StaticResource CircleSliderStyle}"
                                            Width="100"
                                            VerticalAlignment="Center"
                                            Value="{Binding Player.Volume}"
                                            Minimum="0"
                                            Maximum="1"
                                            PreviewMouseWheel="Volume_PreviewMouseWheel" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <Button Width="42"
                                Height="42"
                                Focusable="False"
                                Margin="0,0,6,0"
                                Command="{Binding PrevCommand}">
                            <Image Source="/Resources/previous.png"
                                   Margin="1"
                                   SnapsToDevicePixels="True" />
                        </Button>
                        <Button Width="42"
                                Height="42"
                                Focusable="False"
                                Margin="0,0,6,0"
                                Command="{Binding NextCommand}">
                            <Image Source="/Resources/next.png"
                                   Margin="1"
                                   SnapsToDevicePixels="True" />
                        </Button>
                        <Button Width="84"
                                Height="42"
                                Margin="0"
                                Focusable="False"
                                Content="Browse"
                                FontSize="18"
                                Click="BrowseButton_Click" />
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
